function initGraph(a){margin={top:0,right:30,bottom:40,left:180},width=a.width()-margin.left-margin.right,height=a.height()-margin.top-margin.bottom-65,x=d3.scale.linear().range([0,width]),y=d3.scale.ordinal().rangeRoundBands([0,height],.1,1),xAxis=d3.svg.axis().scale(x).ticks(6).tickSize(height).tickFormat(formatPercent).orient("bottom"),yAxis=d3.svg.axis().scale(y).tickSize(0).orient("left"),y.domain(app.data.map(function(a){return a.label})),x.domain([d3.min(app.data,function(a){return a.diffPercent}),d3.max(app.data,function(a){return a.diffPercent})]),svg=d3.select("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),xTicks=svg.append("g").attr("class","x axis").call(xAxis).append("text").attr("class","title").attr("x",width/2).attr("y",25).attr("dy",".71em").style("text-anchor","middle").text("Så mycket mera tjänar män under en livstid (efter skatt)").attr("transform","translate(0,"+height+")");var b=(svg.append("text").attr("class","title").attr("x",0).attr("y",0).attr("dy",".71em").style("text-anchor","middle").text("Utbildningsinriktning").attr("transform","translate("+(-margin.left+2)+","+height/2+") rotate(-90)"),svg.selectAll(".bar").data(app.data).enter().append("g").attr("class",function(a){return a.column+" bar"}).attr("transform",function(a){var b=Math.min(x(0),x(a.diffPercent)),c=y(a.label);return"translate("+[b,c].join(",")+")"}));b.append("rect").attr("width",function(a){return Math.abs(x(a.diffPercent)-x(0))}).attr("height",y.rangeBand()).attr("fill",function(a){return color(a.group)}),b.append("text").attr("class","label").attr("x",-5).attr("y",y.rangeBand()/2).attr("dy",".35em").style("text-anchor","end").text(function(a){switch(a.column){case"Org_adm":return"Org., adm. och förvaltning";case"Akademiker_totalt":return"Akademiker totalt *)";default:return a.label}}),b.append("text").attr("class","value").attr("x",function(a){return Math.abs(x(a.diffPercent)-x(0))+5}).attr("y",y.rangeBand()/2).attr("dy",".35em").style("text-anchor","start").text(function(a){return a.diffPercent>=.01?formatPercent(a.diffPercent):formatPercentSmall(a.diffPercent)}),b.on("mouseover",function(a){d3.selectAll(".bar:not(.fade)").classed("fade",function(b){return a!==b}).classed("inSelection",!0),d3.select(this).classed("fade",!1).classed("hover",!0),svg.classed("show-all",!1)}).on("mouseout",function(){var a=d3.select(this);a.classed("fade",function(){return!a.classed("inSelection")}),d3.selectAll(".bar.inSelection").classed("fade",!1).classed("inSelection",!1),svg.classed("show-all",d3.select(".story-text").classed("selected"))}).each(function(a,b){var c=("Org_adm"==a.column||"Soc_omsorg",getTooltipText(a));$(this).tooltip({container:"body",placement:"right",html:!0,title:c})})}function updateGraph(){var a=function(a,b){return d3.descending(a.groupMean,b.groupMean)||d3.descending(a.diffPercent,b.diffPercent)},b=y.domain(app.data.sort(a).map(function(a){return a.label})).copy(),c=svg.transition().duration(750),d=function(a,b){return 20*b};c.selectAll(".bar").delay(d).attr("y",function(a){return b(a.label)}),c.select(".y.axis").call(yAxis).selectAll("g").delay(d)}function showSlide(a){var b=""==a.attr("data-columns")?d3.set():d3.set(a.attr("data-columns").split(","));svg.classed("show-all",d3.select(".story-text").classed("selected")),d3.selectAll(".bar").classed("fade",function(a){return!b.has(a.column)&&0!==b.size()})}function initAudio(){$("#track").html('<source src="audio/gender.ogg" type="audio/ogg"><source src="audio/gender.mp3" type="audio/mpeg">')}function initDesktop(){function a(a){$storyItems.removeClass("selected"),a.addClass("selected"),showSlide(a)}initStorySlider(story,["sort"]),initAudio(),$storyItems=$("#story .item"),$storyItems.click(function(){$el=$(this),a($el)}).addClass("shadow");var b=document.getElementById("track"),c=1,d=function(b){a:for(var d=story.length-1;d>=0;d--)if(story[d].time<=b){if(d==c)break a;c=d,a($($storyItems[d]));break a}};b.addEventListener("timeupdate",function(){b.paused||d(this.currentTime)},!1),b.addEventListener("seeked",function(){d(this.currentTime)},!1),b.addEventListener("play",function(){$("#play").hide()},!1),b.addEventListener("ended",function(){},!1)}function numFormat(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"&nbsp;")}function getInternetExplorerVersion(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}function checkVersion(){var a=getInternetExplorerVersion();a>-1&&8>=a&&($("body").empty(),$("body").html('<div style="position:absolute; top:0; left:0; width: 940px; height: 100%; z-index: 100; background-color: #0aaeb1; color: #fff; padding: 20px; "><h3><p style="width: 300px;">Du använder Internet Explorer 8</h3>Den här webbläsaren är för gammal för att visa grafiken. Att använda en gammal browser innebär dessutom stora säkerhetsrisker för din dator. Vi rekommenderar att du uppgraderar din webbläsare på <a href="http://windows.microsoft.com/sv-se/internet-explorer/download-ie" style="color: #fff; text-decoration: underline;">Microsofts hemsida</a>.</p></div>'))}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function initStorySlider(a,b){$("#filters");b||(b=["baseline"]);for(var c={"class":"story-text item"},d=0;d<a.length;d++){var e=a[d];$(".carousel-indicators").append('<li data-target="#story-carousel" data-slide-to="'+d+'"></li>');for(var f=0;f<c.length;f++){var g=b[f];c["data-"+g]=e[g]}c["data-columns"]=e.columns.join(","),$(".carousel-inner").append($("<div/>").attr(c).html(e.text)),$("#story").append($("<div/>").attr(c).html(e.text))}$("#story-carousel .item").first().addClass("active"),$("#story-carousel .carousel-indicators li").first().addClass("active"),$(".carousel").carousel({interval:!1}).on("slide.bs.carousel",function(a){showSlide($(a.relatedTarget))})}function getTooltipText(a,b){var c,b=$.extend({"short":!1},b),d=a.men,e=a.women,f=+d>+e?"manlig":"kvinnlig",g=+d>+e?"kvinnlig":"manlig";switch(a.column){case"Org_adm":f="manlig"==f?"man":"kvinna",g="manlig"==g?"man":"kvinna",c=f+" inom "+a.label.toLowerCase();break;case"Akademiker_totalt":c="genomsnittlig "+f+" akademiker";break;default:c=f+" "+a.label.toLowerCase()}return b["short"]?0==a.diffAbsolute?"Manliga och kvinnliga "+c+" har ungefär samma livslön.":"Livslönen för en "+c+" är "+formatMillionSEK(Math.abs(a.diffAbsolute))+" högre än för en "+g+".":0==a.diffAbsolute?"I den här yrkesgruppen finns det inga större skillnader i livslön.":"Livslönen för en "+c+" är i genomsnitt cirka <strong>"+numFormat(Math.abs(a.diffAbsolute))+" kronor</strong> högre än för en "+g+"."}Handlebars.registerHelper("slugify",function(a,b){var c=a.replace(/[^\w\s]+/gi,"").replace(/ +/gi,"-").replace("åä","a").replace("ö","o");return c.toLowerCase()}),Handlebars.registerHelper("inc",function(a,b){return parseInt(a)+1}),Handlebars.registerHelper("getSentence",function(a,b){var c=app.data.filter(function(b){return b.column==a})[0];return getTooltipText(c)}),Handlebars.registerHelper("getTweet",function(a,b){var c=app.data.filter(function(b){return b.column==a})[0],d=getTooltipText(c,{"short":!0});return encodeURIComponent(d)}),Handlebars.registerHelper("formatPercentDiff",function(a,b){var c="",d=a>=.01?formatPercent(a):formatPercentSmall(a);return a>0&&(c="+"),Math.abs(a)<.001&&(c="+-"),c+d}),Handlebars.registerHelper("getBarStyle",function(a,b){var c=.2,d=Math.abs(Math.round(a/c*100)),e="width: "+d+"%;";return 0>a&&(e+="margin-left:-"+d+"%;",e+="background-color:rgb(178, 50, 50);"),e}),Handlebars.registerPartial("chartItem",$("#mobile-chart-item-template").html());var x,y,xAxis,yAxis;app.renderMobile=function(){var a=d3.nest().key(function(a){return a.group}).entries(app.data),b=d3.select("#mobile-chart-template"),c=b.html(),d=Handlebars.compile(c);d3.select("#mobile-chart").html(d({groupedData:a,sortedData:app.data.sort(function(a,b){return d3.descending(a.diffPercent,b.diffPercent)})}));var b=d3.select("#mobile-story-template"),c=b.html(),d=Handlebars.compile(c);d3.select("#mobile-story").html(d(storyMobile)),$(".toggle-collapse").click(function(){$(this).toggleClass("active")}),$(".sort").click(function(){$(".sort").toggleClass("active"),$(".sort-by-group, .sort-by-value").toggleClass("hidden")}),$(".count-up").each(function(){var a=$(this),b=a.attr("id"),c=+a.attr("data-value"),d=a.attr("data-suffix"),e=new countUp(b,0,c,0,3,{useEasing:!0,useGrouping:!0,separator:" ",decimal:",",prefix:"",suffix:d});$.data(this,"counter",e),new Waypoint({element:document.getElementById(b),handler:function(a){$(this.element).data().counter.start()},offset:"85%"})})},$(app).on("app:dataReady",function(a){app.mobile?($("body").addClass("mobile"),app.renderMobile()):($("body").addClass("desktop"),initDesktop(),initGraph($("#viz")),$firstSlide=$("#story .item").first().next(),showSlide($firstSlide),$firstSlide.addClass("selected")),app.initShareButtons();var b=self!==top;if(b){var c=new pym.Child;c.sendHeight()}}),app.init=function(){app.data=[],app.groupMeans={},d3.tsv(app.dataPath,function(a,b){for(var c={},d=0;d<filters.length;d++)for(var e=filters[d],f=0;f<e.length;f++)for(var g=e[f],h=0;h<g.items.length;h++){var i=g.items[h],j=i.column;i.men=b[0][j],i.women=b[1][j],i.group=g.name_short,i.diffPercent=i.men/i.women-1,i.diffAbsolute=1e5*Math.round((i.men-i.women)/1e5),"Akademiker_totalt"==j&&(i.diffAbsolute=26e5),i.men>0&&"Arkitekt"!==i.column&&app.data.push(i),"undefined"==typeof c[i.group]&&(c[i.group]=[]),c[i.group].push(i.diffPercent)}app.groupMeans={};for(var d in c)app.groupMeans[d]=d3.mean(c[d]);for(var d=0;d<app.data.length;d++)app.data[d].groupMean=app.groupMeans[app.data[d].group];var k=function(a,b){return d3.descending(a.groupMean,b.groupMean)||d3.descending(a.diffPercent,b.diffPercent)};app.data=app.data.sort(k),$(app).trigger("app:dataReady")})},app.initShareButtons=function(){var a=app.urlToShare,b="Manliga akademiker tjänar 2,6 miljoner mer än kvinnliga under en livstid",c=encodeURIComponent("Saco: "+b),d=encodeURIComponent("Kolla hur stora löneskillnaderna är mellan män och kvinnor är i just din utbildningsgrupp."),e="http://www.facebook.com/sharer.php?s=100&p[title]="+c+"&p[summary]="+d+"&p[url]="+a+"&p[images][0]=http://jplusplus.se/u/saco_livslon/images/logo.png",f="http://twitter.com/share?url="+a+"&text="+encodeURIComponent(b+" @akademikerna #livslön ");$(".facebook-link").click(function(){return window.open(e,"facebook-share-dialog","width=626,height=436"),!1}),$(".twitter-link").attr({"data-url":a}),app.mobile||$(".twitter-link").attr({href:f}).click(function(a){var b=575,c=400,d=($(window).width()-b)/2,e=($(window).height()-c)/2,g="status=1,width="+b+",height="+c+",top="+e+",left="+d;return window.open(f,"twitter",g),!1})};var story=[{text:"Kvinnor tjänar i genomsnitt <strong>2,6 miljoner kronor mindre</strong> än män över livet",sort:"all",columns:["Akademiker_totalt"],time:7},{text:"Män tjänar mer än kvinnor i <strong>nästan alla yrkesgrupper</strong>.",sort:"all",columns:[],time:37},{text:"Störst är skillnaderna bland <strong>ingenjörer, ekonomer och samhällsvetare</strong>.",sort:"all",columns:["Hgsk_ing","Ekonom","Civ_ing","Samhbetvet"],time:41},{text:"Inom <strong>vård och omsorg är skillnaderna minst</strong>, men också där tjänar män mer.",sort:"all",columns:["Lakare","Sjukgymn","Sjukskoterska","Soc_omsorg","Socionom","Tandlakare","Apotekare","Biomed_analyt"],time:47},{text:"Bara i några få yrken är livslönerna jämställda.",sort:"all",columns:["Soc_omsorg","Teolog","Veterinar","Biblinfo"],time:58}],storyMobile=[{type:"count-up",value:26e5,unit:" kr",text:"Så mycket mer tjänar manliga akademiker män i snitt under en livstid."},{type:"count-up",value:120,unit:"%",text:"Här kommer en annan stor siffra."}],filters=[[{name:"Rensa alla val",name_short:"Rensa alla val",cssClass:"Rensa",items:[]},{name:"Pedagogik och lärarutbildning",name_short:"Lärare",cssClass:"sort",items:[{label:"Låg- och mellanstadielärare",column:"lagmellanstdlr",baseline:"GymnSamhv"},{label:"Högstadie- och gymnasielärare",column:"amneslarare",baseline:"GymnSamhv"},{label:"Lärare i praktiskt-estetiskt ämne",column:"lararePrakEstet",baseline:"GymnSamhv"},{label:"Yrkeslärare",column:"yrkeslarare",baseline:"GymnSamhv"}]},{name:"Humaniora och konst",name_short:"Humaniora, konst",cssClass:"sort",items:[{label:"Bibliotekarie och informationsvetare",column:"Biblinfo",baseline:"GymnSamhv"},{label:"Humanist",column:"Humanist",baseline:"GymnSamhv"},{label:"Konstvetare",column:"Konstutb",baseline:"GymnSamhv"},{label:"Teolog",column:"Teolog",baseline:"GymnSamhv"}]}],[{name:"Samhällsvetenskap, juridik, handel och administration",name_short:"Samhällsvetenskap m.m.",cssClass:"sort",items:[{label:"Ekonom",column:"Ekonom",baseline:"GymnSamhv"},{label:"Organisation, administration och förvaltning",column:"Org_adm",baseline:"GymnSamhv"},{label:"Jurist",column:"Jurist",baseline:"GymnSamhv"},{label:"Journalist",column:"Journalist",baseline:"GymnSamhv"},{label:"Psykolog",column:"Psykolog",baseline:"GymnSamhv"},{label:"Samhälls- och beteendevetare",column:"Samhbetvet",baseline:"GymnSamhv"}]}],[{name:"Teknik och tillverkning",name_short:"Teknik",cssClass:"sort",items:[{label:"Arkitekt",column:"Arkitekt",baseline:"GymnNatv"},{label:"Civilingenjör",column:"Civ_ing",baseline:"GymnNatv"},{label:"Högskoleingenjör",column:"Hgsk_ing",baseline:"GymnNatv"}]},{name:"Lant- och skogsbruk samt djursjukvård",name_short:"Lantbruk, djursjukvård",cssClass:"sort",items:[{label:"Agronom",column:"Agronom",baseline:"GymnNatv"},{label:"Veterinär",column:"Veterinar",baseline:"GymnNatv"}]},{name:"Social omsorg",name_short:"Social omsorg",cssClass:"sort",items:[{label:"Social omsorg ",column:"Soc_omsorg",baseline:"GymnSamhv"},{label:"Socionom",column:"Socionom",baseline:"GymnSamhv"}]}],[{name:"Hälso- och sjukvård",name_short:"Hälso- och sjukvård",cssClass:"sort",items:[{label:"Apotekare",column:"Apotekare",baseline:"GymnNatv"},{label:"Arbetsterapeut",column:"Arbterap",baseline:"GymnSamhv"},{label:"Biomedicinsk analytiker",column:"Biomed_analyt",baseline:"GymnSamhv"},{label:"Läkare",column:"Lakare",baseline:"GymnNatv"},{label:"Receptarie",column:"Receptarie",baseline:"GymnNatv"},{label:"Fysioterapeut/sjukgymnast",column:"Sjukgymn",baseline:"GymnNatv"},{label:"Sjuksköterska",column:"Sjukskoterska",baseline:"GymnSamhv"},{label:"Tandhygienist",column:"Tandhyg",baseline:"GymnSamhv"},{label:"Tandläkare",column:"Tandlakare",baseline:"GymnNatv"}]}],[{name:"Naturvetenskap, matematik, data",name_short:"Naturvetenskap",cssClass:"sort",items:[{label:"Systemvetare",column:"Systvet",baseline:"GymnSamhv"},{label:"Geovetare",column:"Geovet",baseline:"GymnNatv"},{label:"Kemist",column:"Kemist",baseline:"GymnNatv"},{label:"Matematiker och statistiker",column:"Matstat",baseline:"GymnNatv"},{label:"Datavetare",column:"Datavet",baseline:"GymnNatv"},{label:"Biolog",column:"Biolog",baseline:"GymnNatv"}]},{name:"Övriga",name_short:"Sammanräknade",cssClass:"sort",items:[{label:"Akademiker, totalt",column:"Akademiker_totalt",baseline:"GymnSamhNatv"}]}]],categories=d3.merge(filters.map(function(a){return a.map(function(a){return a.name_short})})),color=d3.scale.category10().domain(categories);checkVersion();var locale=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:[""," kr"],dateTime:"%A %e %B %Y kl. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["måndag","tisdag","onsdag","torsdag","fredag","lördag","söndag"],shortDays:["må","ti","ons","to","fre","lö","sö"],months:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],shortMonths:["jan","feb","mars","apr","maj","jun","jul","aug","sept","okt","nov","dec"]}),formatMillionSEK=function(a){return locale.numberFormat(".2s")(a).replace("k"," tKr").replace("M"," Mkr")},formatPercent=locale.numberFormat(".0%"),formatPercentSmall=locale.numberFormat(".1%");